package net.tarasandedevelopment.tarasande.base.features.screenexploit

import com.viaversion.viaversion.api.protocol.version.ProtocolVersion
import net.minecraft.client.MinecraftClient
import net.minecraft.client.gui.screen.Screen
import net.minecraft.client.gui.screen.ingame.InventoryScreen
import net.tarasandedevelopment.tarasande.TarasandeMain
import net.tarasandedevelopment.tarasande.base.Manager
import net.tarasandedevelopment.tarasande.event.EventChildren
import net.tarasandedevelopment.tarasande.features.protocol.util.ProtocolRange
import net.tarasandedevelopment.tarasande.features.screenexploit.ScreenExploitCraftingDupe
import net.tarasandedevelopment.tarasande.features.screenexploit.ScreenExploitLecternCrash
import net.tarasandedevelopment.tarasande.screen.cheatmenu.panel.impl.minecraftbutton.PanelButton

class ManagerScreenExploit : Manager<ScreenExploit>() {

    init {
        add(
            ScreenExploitCraftingDupe(),
            ScreenExploitLecternCrash()
        )

        TarasandeMain.get().managerEvent.add(EventChildren::class.java) {
            list.forEachIndexed { index, screenExploit ->
                if (screenExploit.screens.contains(it.screen.javaClass)) {
                    it.add(PanelButton.createButton(5, 5 + (index * 24), 98, 25, screenExploit.name + " (" + screenExploit.version + ")") {
                        screenExploit.onClick(MinecraftClient.getInstance().currentScreen as InventoryScreen)
                    })
                }
            }
        }
    }
}

abstract class ScreenExploit(val name: String, val version: ProtocolRange, vararg val screens: Class<out Screen>) {

    abstract fun onClick(inventory: InventoryScreen)
}
