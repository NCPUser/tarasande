package su.mandora.tarasande_dupe_exploits.command

import com.mojang.brigadier.arguments.IntegerArgumentType
import com.mojang.brigadier.builder.LiteralArgumentBuilder
import net.minecraft.command.CommandSource
import net.minecraft.item.Items
import net.minecraft.network.packet.c2s.play.PlayerInteractEntityC2SPacket
import net.minecraft.util.Hand
import su.mandora.tarasande.mc
import su.mandora.tarasande.system.feature.commandsystem.Command
import su.mandora.tarasande.util.player.chat.CustomChat

class CommandCowDupe : Command("cowdupe") {

    private fun execute(count: Int = 150) {
        if (mc.player!!.inventory.mainHandStack.isOf(Items.SHEARS)) {
            for (i in 0 .. count) {
                if (mc.targetedEntity != null) {
                    mc.networkHandler!!.sendPacket(PlayerInteractEntityC2SPacket.interact(mc.targetedEntity, mc.player!!.isSneaking, Hand.MAIN_HAND))
                    CustomChat.printChatMessage("Finished shearing targeted entity")
                }
            }
        } else {
            CustomChat.printChatMessage("You need to hold shears to do the glitch")
        }
    }

    override fun builder(builder: LiteralArgumentBuilder<CommandSource>): LiteralArgumentBuilder<CommandSource> {
        builder.then(argument("count", IntegerArgumentType.integer())!!.executes {
            execute(IntegerArgumentType.getInteger(it, "count"))
            return@executes SUCCESS
        })

        return builder.executes {
            execute()
            return@executes SUCCESS
        }
    }
}
